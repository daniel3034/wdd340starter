<main>
  <h1><%= title %></h1>
  
  <!-- Flash messages -->
  <%- messages() %>
  
  <p>Manage customer reviews and ratings. Approve or reject reviews before they appear publicly.</p>
  
  <% if (reviews && reviews.length > 0) { %>
    <div class="reviews-table-container">
      <table class="reviews-table">
        <thead>
          <tr>
            <th>Vehicle</th>
            <th>Customer</th>
            <th>Rating</th>
            <th>Title</th>
            <th>Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% reviews.forEach(review => { %>
            <tr class="<%= review.review_approved ? 'approved' : 'pending' %>">
              <td>
                <strong><%= review.inv_year %> <%= review.inv_make %> <%= review.inv_model %></strong>
              </td>
              <td>
                <%= review.account_firstname %> <%= review.account_lastname %>
              </td>
              <td>
                <div class="rating-display">
                  <% for (let i = 1; i <= 5; i++) { %>
                    <span class="star <%= i <= review.review_rating ? 'filled' : '' %>">â˜…</span>
                  <% } %>
                  (<%= review.review_rating %>)
                </div>
              </td>
              <td>
                <strong><%= review.review_title %></strong>
                <div class="review-preview">
                  <%= review.review_text.length > 100 ? 
                      review.review_text.substring(0, 100) + '...' : 
                      review.review_text %>
                </div>
              </td>
              <td>
                <%= new Date(review.review_date).toLocaleDateString() %>
              </td>
              <td>
                <span class="status-badge <%= review.review_approved ? 'approved' : 'pending' %>">
                  <%= review.review_approved ? 'Approved' : 'Pending' %>
                </span>
              </td>
              <td class="actions">
                <% if (!review.review_approved) { %>
                  <form action="/reviews/approve" method="post" style="display: inline;">
                    <input type="hidden" name="review_id" value="<%= review.review_id %>">
                    <input type="hidden" name="approved" value="true">
                    <button type="submit" class="btn btn-approve">Approve</button>
                  </form>
                <% } else { %>
                  <form action="/reviews/approve" method="post" style="display: inline;">
                    <input type="hidden" name="review_id" value="<%= review.review_id %>">
                    <input type="hidden" name="approved" value="false">
                    <button type="submit" class="btn btn-reject">Unapprove</button>
                  </form>
                <% } %>
                
                <a href="/reviews/delete/<%= review.review_id %>" 
                   class="btn btn-delete"
                   onclick="return confirm('Are you sure you want to delete this review?')">
                  Delete
                </a>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <p class="no-reviews">No reviews found.</p>
  <% } %>
</main>